<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Insights - AI Portfolio Analyzer</title>
    
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        body {
            color: #eee;
            background: #111;
            font-family: Inter, system-ui, Arial, sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–æ–µ –º–µ–Ω—é - –≤–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        /* –ó–∞—á–µ–º: –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ä–∞–∑–¥–µ–ª–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        nav {
            background: #1a1a1a;
            border-bottom: 1px solid #333;
            padding: 0;
        }
        
        nav ul {
            display: flex;
            gap: 0;
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        nav li {
            margin: 0;
        }
        
        nav a {
            color: #ddd;
            text-decoration: none;
            padding: 16px 24px;
            display: block;
            border-right: 1px solid #333;
            transition: background-color 0.2s;
        }
        
        nav a:hover {
            background: #222;
            color: #fff;
        }
        
        nav a.active {
            background: #333;
            color: #fff;
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .page-header h1 {
            font-size: 2.5rem;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .page-header p {
            font-size: 1.1rem;
            color: #aaa;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* –°–µ—Ç–∫–∞ —Å–µ–∫—Ü–∏–π AI Insights */
        /* –ó–∞—á–µ–º: –û—Ä–≥–∞–Ω–∏–∑—É–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –±–ª–æ–∫–∏ AI –∞–Ω–∞–ª–∏–∑–∞ –≤ —É–¥–æ–±–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É */
        .insights-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 32px;
        }
        
        /* –°–µ–∫—Ü–∏—è AI Insights */
        .insight-section {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 24px;
        }
        
        .insight-section h2 {
            margin: 0 0 20px 0;
            color: #667eea;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .insight-section h2::before {
            content: "üß†";
            font-size: 1.2em;
        }
        
        /* LLM Test Panel - –æ—Å–Ω–æ–≤–Ω–∞—è —Å–µ–∫—Ü–∏—è */
        .llm-test-panel {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 24px;
        }
        
        .llm-test-panel h2 {
            margin: 0 0 20px 0;
            color: #667eea;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .llm-test-panel h2::before {
            content: "üî¨";
            font-size: 1.2em;
        }
        
        /* –§–æ—Ä–º–∞ LLM —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */
        .llm-form {
            display: grid;
            gap: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-group label {
            color: #ddd;
            font-weight: 600;
            font-size: 14px;
        }
        
        .form-group input,
        .form-group textarea {
            padding: 12px;
            background: #222;
            color: #eee;
            border: 1px solid #444;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Monaco', 'Menlo', monospace;
            transition: border-color 0.2s;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-group input[type="text"] {
            font-family: inherit;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ */
        .run-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            justify-self: start;
        }
        
        .run-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        .run-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* –ë–ª–æ–∫–∏ –≤—ã–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
        .output-section {
            margin-top: 24px;
            display: grid;
            gap: 16px;
        }
        
        .output-block {
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 16px;
        }
        
        .output-block h3 {
            margin: 0 0 12px 0;
            color: #667eea;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .output-content {
            background: #111;
            border: 1px solid #222;
            border-radius: 6px;
            padding: 12px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            line-height: 1.5;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            color: #ccc;
        }
        
        .trace-id {
            color: #888;
            font-size: 12px;
            font-family: 'Monaco', 'Menlo', monospace;
        }
        
        /* Placeholder —Å–µ–∫—Ü–∏–∏ */
        .placeholder-section {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            color: #666;
        }
        
        .placeholder-section h2 {
            margin: 0 0 16px 0;
            color: #555;
            font-size: 1.3rem;
        }
        
        .placeholder-section p {
            margin: 0;
            color: #666;
            font-style: italic;
        }
        
        /* –°—Ç–∞—Ç—É—Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã */
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status.success {
            background: #1a4d1a;
            color: #4ade80;
        }
        
        .status.error {
            background: #4d1a1a;
            color: #f87171;
        }
        
        .status.loading {
            background: #4d3d1a;
            color: #fbbf24;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .container {
                padding: 20px 16px;
            }
            
            .page-header h1 {
                font-size: 2rem;
            }
            
            .insights-grid {
                gap: 24px;
            }
            
            .llm-form {
                gap: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- –í–µ—Ä—Ö–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <!-- –ó–∞—á–µ–º: –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ä–∞–∑–¥–µ–ª–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <!-- –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—É–Ω–∫—Ç: –¥–æ–±–∞–≤—å—Ç–µ <li><a href="/ui/–Ω–æ–≤–∞—è_—Å—Ç—Ä–∞–Ω–∏—Ü–∞.html">–ù–∞–∑–≤–∞–Ω–∏–µ</a></li> -->
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="ai_insights.html" class="active">AI Insights</a></li>
            <li><a href="portfolio_editor.html">Portfolio Editor</a></li>
            <li><a href="portfolio_snapshot.html">Portfolio Snapshot</a></li>
            <li><a href="valuations.html">Valuations</a></li>
        </ul>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
        <div class="page-header">
            <h1>üß† AI Insights</h1>
            <p>–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ—Ä—Ç—Ñ–µ–ª—è —Å –ø–æ–º–æ—â—å—é –ª–æ–∫–∞–ª—å–Ω—ã—Ö LLM –º–æ–¥–µ–ª–µ–π</p>
        </div>

        <!-- –°–µ—Ç–∫–∞ —Å–µ–∫—Ü–∏–π AI Insights -->
        <!-- –ó–∞—á–µ–º: –û—Ä–≥–∞–Ω–∏–∑—É–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –±–ª–æ–∫–∏ AI –∞–Ω–∞–ª–∏–∑–∞ –≤ —É–¥–æ–±–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É -->
        <!-- –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å–µ–∫—Ü–∏—é: –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π .insight-section —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º id -->
        <div class="insights-grid">
            <!-- –°–µ–∫—Ü–∏—è Portfolio Summary -->
            <div class="insight-section" id="portfolio-summary">
                <h2>Portfolio Summary</h2>
                <div class="placeholder-section">
                    <h2>üìä –ê–Ω–∞–ª–∏–∑ –ø–æ—Ä—Ç—Ñ–µ–ª—è</h2>
                    <p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å–≤–æ–¥–∫–∞ –ø–æ –ø–æ—Ä—Ç—Ñ–µ–ª—é: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–æ–≤, –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å, –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏</p>
                </div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è Risk & Alerts -->
            <div class="insight-section" id="risk-alerts">
                <h2>Risk & Alerts</h2>
                <div class="placeholder-section">
                    <h2>‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è</h2>
                    <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ —Ä–∏—Å–∫–∞—Ö, –∞–Ω–æ–º–∞–ª–∏—è—Ö –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Ä–∏—Å–∫–∞–º–∏</p>
                </div>
            </div>

            <!-- LLM Test Panel - –æ—Å–Ω–æ–≤–Ω–∞—è —Å–µ–∫—Ü–∏—è -->
            <!-- –ó–∞—á–µ–º: –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ LLM –º–æ–¥–µ–ª–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è -->
            <div class="llm-test-panel" id="llm-test-panel">
                <h2>LLM Test Panel</h2>
                
                <!-- –û–ø–∏—Å–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ -->
                <p style="color: #aaa; margin-bottom: 24px; font-size: 14px;">
                    –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ LLM –º–æ–¥–µ–ª–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è. –í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–ø—Ç, –≤—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –∏ –ø–æ–ª—É—á–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç.
                    –ï—Å–ª–∏ —É–∫–∞–∑–∞—Ç—å JSON Schema, –æ—Ç–≤–µ—Ç –±—É–¥–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.
                </p>

                <!-- –§–æ—Ä–º–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è LLM -->
                <form class="llm-form" id="llmForm">
                    <!-- –ü–æ–ª–µ –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞ -->
                    <div class="form-group">
                        <label for="prompt">–ü—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:</label>
                        <textarea 
                            id="prompt" 
                            name="prompt" 
                            placeholder="–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –º–æ–π –ø–æ—Ä—Ç—Ñ–µ–ª—å: 60% –∞–∫—Ü–∏–∏ (AAPL, MSFT, GOOGL), 30% –æ–±–ª–∏–≥–∞—Ü–∏–∏ (BND), 10% –∑–æ–ª–æ—Ç–æ (GLD). –ö–∞–∫–∏–µ —Ä–∏—Å–∫–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏?"
                            required
                        ></textarea>
                    </div>

                    <!-- –ü–æ–ª–µ –¥–ª—è –º–æ–¥–µ–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
                    <div class="form-group">
                        <label for="model">–ú–æ–¥–µ–ª—å LLM (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –¥–µ—Ñ–æ–ª—Ç–∞):</label>
                        <input 
                            type="text" 
                            id="model" 
                            name="model" 
                            placeholder="llama3.1:8b, gemma2:9b, qwen2.5-coder:7b"
                        />
                    </div>

                    <!-- –ü–æ–ª–µ –¥–ª—è JSON Schema (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
                    <div class="form-group">
                        <label for="jsonSchema">JSON Schema (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞):</label>
                        <textarea 
                            id="jsonSchema" 
                            name="jsonSchema" 
                            placeholder='{"type": "object", "properties": {"analysis": {"type": "string"}, "risks": {"type": "array"}, "recommendations": {"type": "array"}}}'
                        ></textarea>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ -->
                    <button type="submit" class="run-button" id="runButton">
                        üöÄ Run
                    </button>
                </form>

                <!-- –ë–ª–æ–∫–∏ –≤—ã–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
                <div class="output-section" id="outputSection" style="display: none;">
                    <!-- –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è -->
                    <div class="output-block">
                        <h3>Status</h3>
                        <div id="statusIndicator" class="status">Ready</div>
                    </div>

                    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è -->
                    <div class="output-block">
                        <h3>Result</h3>
                        <div id="resultRaw" class="output-content">–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...</div>
                    </div>

                    <!-- Trace ID –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ -->
                    <div class="output-block">
                        <h3>Trace ID</h3>
                        <div id="traceId" class="trace-id">–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ LLM —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <!-- –ó–∞—á–µ–º: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã, –≤–∞–ª–∏–¥–∞—Ü–∏—é JSON, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    <script>
        // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM
        // –ó–∞—á–µ–º: –°—Å—ã–ª–∫–∏ –Ω–∞ HTML —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π
        const form = document.getElementById('llmForm');
        const runButton = document.getElementById('runButton');
        const outputSection = document.getElementById('outputSection');
        const statusIndicator = document.getElementById('statusIndicator');
        const resultRaw = document.getElementById('resultRaw');
        const traceId = document.getElementById('traceId');
        const jsonSchemaField = document.getElementById('jsonSchema');

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Trace ID
        // –ó–∞—á–µ–º: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
        function getOrCreateTraceId() {
            let traceId = localStorage.getItem('trace_id');
            if (!traceId) {
                traceId = `trace_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                localStorage.setItem('trace_id', traceId);
            }
            return traceId;
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è JSON Schema
        // –ó–∞—á–µ–º: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ JSON –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        function validateJsonSchema(schemaText) {
            if (!schemaText.trim()) {
                return { valid: true, schema: null };
            }
            
            try {
                const schema = JSON.parse(schemaText);
                return { valid: true, schema: schema };
            } catch (error) {
                return { valid: false, error: error.message };
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏
        // –ó–∞—á–µ–º: –ò–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
        function showLoading() {
            runButton.disabled = true;
            runButton.innerHTML = '<span class="loading-spinner"></span>Running‚Ä¶';
            outputSection.style.display = 'grid';
            statusIndicator.textContent = 'Loading';
            statusIndicator.className = 'status loading';
            resultRaw.textContent = '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ LLM...';
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        // –ó–∞—á–µ–º: –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã LLM
        function showSuccess(data, responseHeaders) {
            runButton.disabled = false;
            runButton.innerHTML = 'üöÄ Run';
            statusIndicator.textContent = 'Success';
            statusIndicator.className = 'status success';
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            let formattedResponse = '';
            if (data.success) {
                formattedResponse += `‚úÖ –ú–æ–¥–µ–ª—å: ${data.model}\n`;
                formattedResponse += `üî¢ –¢–æ–∫–µ–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${data.tokens_used || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}\n\n`;
                formattedResponse += `üìù –û—Ç–≤–µ—Ç:\n${data.response}\n\n`;
                
                if (data.raw_response) {
                    formattedResponse += `üîß –°—ã—Ä–æ–π –æ—Ç–≤–µ—Ç –æ—Ç Ollama:\n${data.raw_response}`;
                }
            } else {
                formattedResponse = `‚ùå –û—à–∏–±–∫–∞: ${data.error}`;
            }
            
            resultRaw.textContent = formattedResponse;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º Trace ID
            const traceIdValue = responseHeaders.get('X-Trace-Id') || '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
            traceId.textContent = traceIdValue;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        // –ó–∞—á–µ–º: –ò–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–± –æ—à–∏–±–∫–∞—Ö
        function showError(error) {
            runButton.disabled = false;
            runButton.innerHTML = 'üöÄ Run';
            statusIndicator.textContent = 'Error';
            statusIndicator.className = 'status error';
            
            let errorMessage = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞.\n\n';
            if (error.message) {
                errorMessage += `–°–æ–æ–±—â–µ–Ω–∏–µ: ${error.message}\n`;
            }
            if (error.detail) {
                errorMessage += `–î–µ—Ç–∞–ª–∏: ${error.detail}\n`;
            }
            errorMessage += '\nüí° –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:\n';
            errorMessage += '- –ó–∞–ø—É—â–µ–Ω –ª–∏ Ollama: ollama serve\n';
            errorMessage += '- –°–∫–∞—á–∞–Ω–∞ –ª–∏ –º–æ–¥–µ–ª—å: ollama list\n';
            errorMessage += '- –î–æ—Å—Ç—É–ø–µ–Ω –ª–∏ API: http://localhost:11434/api/tags';
            
            resultRaw.textContent = errorMessage;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        // –ó–∞—á–µ–º: –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –∫ LLM —á–µ—Ä–µ–∑ FastAPI
        form.addEventListener('submit', async (e) => {
            e.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã
            
            // –í–∞–ª–∏–¥–∏—Ä—É–µ–º JSON Schema
            const schemaValidation = validateJsonSchema(jsonSchemaField.value);
            if (!schemaValidation.valid) {
                // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –ø–æ–ª–µ —Å –æ—à–∏–±–∫–æ–π
                jsonSchemaField.style.borderColor = '#f87171';
                jsonSchemaField.style.backgroundColor = '#4d1a1a';
                resultRaw.textContent = `‚ùå –û—à–∏–±–∫–∞ –≤ JSON Schema: ${schemaValidation.error}`;
                outputSection.style.display = 'grid';
                return;
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –æ—à–∏–±–∫–∏
            jsonSchemaField.style.borderColor = '#444';
            jsonSchemaField.style.backgroundColor = '#222';
            
            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
            // –ó–∞—á–µ–º: –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫ API
            const formData = new FormData(form);
            const requestData = {
                prompt: formData.get('prompt'),
                model: formData.get('model') || undefined,
                json_schema: schemaValidation.schema,
                temperature: 0.7,
                max_tokens: 1000
            };
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏
            showLoading();
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º Trace ID
                const currentTraceId = getOrCreateTraceId();
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ FastAPI
                // –ó–∞—á–µ–º: –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—à LLM proxy —Ä–æ—É—Ç–µ—Ä
                const response = await fetch('/llm/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Trace-Id': currentTraceId
                    },
                    body: JSON.stringify(requestData)
                });
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`HTTP ${response.status}: ${errorData.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                }
                
                // –ü–æ–ª—É—á–∞–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç
                const data = await response.json();
                showSuccess(data, response.headers);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞:', error);
                showError(error);
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        // –ó–∞—á–µ–º: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π Trace ID
        document.addEventListener('DOMContentLoaded', () => {
            const initialTraceId = getOrCreateTraceId();
            traceId.textContent = initialTraceId;
        });
    </script>
</body>
</html>
